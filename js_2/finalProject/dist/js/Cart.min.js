class Cart{constructor(t,e="#cart"){this.source=t,this.container=e,this.countGoods=0,this.amount=0,this.cartItems=[],this._init(this.source)}_render(){let t=$("<div/>",{class:"cart-items-wrap"}),e=$("<div/>",{class:"cart-summary sum-amount"}),i=$("<div/>",{class:"cart-summary sum-price"});$(this.container).text("Корзина"),t.appendTo($(this.container)),e.appendTo($(this.container)),i.appendTo($(this.container))}_init(t){this._render(),fetch(t).then(t=>t.json()).then(t=>{for(let e of t.contents)this.cartItems.push(e),this._renderItem(e);this.countGoods=t.countGoods,this.amount=t.amount,this._renderSum()})}_renderSum(){$(".sum-amount").text(`Всего товаров в корзине: ${this.countGoods}`),$(".sum-price").text(`Общая сумма: ${this.amount} руб`)}_renderItem(t){let e=$("<div/>",{class:"cart-item","data-product":t.id_product}),i=$("<button>",{class:"delBtn",text:"Удалить"});i.on("click",t=>this._remove(t.target.parentNode)),e.append($(`<p class="product-name">${t.product_name}</p>`)),e.append($(`<p class="product-quantity">${t.quantity}</p>`)),e.append($(`<p class="product-price">${t.price} руб.</p>`)),e.append(i),e.appendTo($(".cart-items-wrap"))}_updateCart(t){let e=$(`div[data-product="${t.id_product}"]`);e.find(".product-quantity").text(t.quantity),e.find(".product-price").text(`${t.quantity*t.price} руб`)}addProduct(t){let e=+$(t).data("id"),i=this.cartItems.find(t=>t.id_product===e);if(i)i.quantity++,this.countGoods++,this.amount+=i.price,this._updateCart(i);else{let i={id_product:e,price:+$(t).data("price"),product_name:$(t).data("title"),quantity:1};this.cartItems.push(i),this.countGoods++,this.amount+=i.price,this._renderItem(i)}this._renderSum()}_remove(t){let e=$(t).data("product"),i=this.cartItems.find(t=>t.id_product===e);if(i)if(i.quantity--,this.countGoods--,this.amount-=i.price,0===i.quantity){t.remove();let i=this.cartItems.findIndex(t=>t.id_product===e);this.cartItems.splice(i,1)}else this._updateCart(i);else console.log("error");this._renderSum()}}
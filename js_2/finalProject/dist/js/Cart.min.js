class Cart{constructor(t,a="#cart",e=!1){this.source=t,this.container=a,this.isBigCart=e,this.countGoods=0,this.amount=0,this.cartItems=[],this._init(this.source)}_render(){let t=$("<div/>",{class:"cart-items-wrap"}),a=$("<div/>",{class:"cart-price"}),e=$("<div/>",{class:"cart-buttons-box"});t.appendTo($(this.container)),a.append($("<p>TOTAL</p>")),a.append($('<p class="sum-price"></p>')),a.appendTo($(this.container)),e.append($('<a class="button-site checkout-button" href="checkout.html">Checkout</a>')),e.append($('<a class="drop-cart-button" href="shopping-cart.html">Go to cart</a>')),e.appendTo($(this.container))}_renderBig(){let t=$(".cart-columns"),a=$("<div/>",{class:"cart-columns__details"}),e=$("<a/>",{class:"cart-button cart-buttons__button delAllBtn",href:"#"});e.text("cLEAR SHOPPING CART"),e.on("click",()=>this._removeAll()),$(".cart-buttons").prepend(e),a.append($('<h3 class="cart-columns__details__h">Product Detailsh</h3>')),t.append(a),t.append($('<h3 class="cart-columns__h">unite Price</h3>')),t.append($('<h3 class="cart-columns__h">Quantity\t</h3>')),t.append($('<h3 class="cart-columns__h">shipping\t</h3>')),t.append($('<h3 class="cart-columns__h">Subtotal</h3>')),t.append($('<h3 class="cart-columns__h">ACTION</h3>'))}_init(t){if(this.isBigCart?this._renderBig():this._render(),localStorage.getItem("mycart")){this.cartItems=JSON.parse(localStorage.getItem("mycart"));for(let t of this.cartItems)this.isBigCart?this._renderBigItem(t):this._renderItem(t);this.countGoods=JSON.parse(localStorage.getItem("countGoods")),this.amount=JSON.parse(localStorage.getItem("amount")),this._renderSum()}else fetch(t).then(t=>t.json()).then(t=>{for(let a of t.contents)this.cartItems.push(a),this.isBigCart?this._renderBigItem(a):this._renderItem(a);this.countGoods=t.countGoods,this.amount=t.amount,localStorage.setItem("mycart",JSON.stringify(this.cartItems)),localStorage.setItem("countGoods",this.countGoods),localStorage.setItem("amount",this.amount),this._renderSum()})}_renderSum(){$(".sum-price").text(`$${this.amount}`),0===this.countGoods&&($(this.container).prepend($('<p class="emptyCart"> Your cart is empty.</p>')),this.isBigCart?$(".delAllBtn").hide():$(".cart-buttons-box").hide(),this.isBigCart?$(".cart-buttons-box").hide():$(".cart-price").hide())}_renderItem(t){let a=$("<div/>",{class:"cart-item-box"}),e=$("<div/>",{class:"cart-item-container"}),s=$("<a/>",{class:"single-page-link",href:"single-page.html"}),r=$("<div/>",{class:"cart-product-info","data-id":t.id_product}),i=$("<a/>",{class:"single-page-link",href:"single-page.html"}),c=$("<a>",{class:"cart-del-item",href:`#del_${t.id_product}`,"data-id":t.id_product});s.append($(`<img class="cart-img" src="${t.min_img}" alt="product1">`)),s.appendTo(e),i.append($(`<h3>${t.product_name}</h3>`)),i.appendTo(r),r.append($('<i class="fas fa-star item-stars"></i>')),r.append($('<i class="fas fa-star item-stars"></i>')),r.append($('<i class="fas fa-star item-stars"></i>')),r.append($('<i class="fas fa-star item-stars"></i>')),r.append($('<i class="fas fa-star-half-alt item-stars"></i>')),r.append($(`<p> <span class="product-quantity">${t.quantity}</span> x \n                            <span class="product-price">$${t.price}</span></p>`)),r.appendTo(e),c.on("click",t=>this._remove(t.target.parentNode)),c.append($('<i class="fas fa-times-circle"></i>')),c.appendTo(e),e.appendTo(a),a.appendTo($(".cart-items-wrap"))}_renderBigItem(t){let a=$("<div/>",{class:"cart-product-details","data-id":`${t.id_product}`}),e=$("<a/>",{href:"single-page.html"}),s=$("<div/>",{class:"cart-product-details__text-box"}),r=$("<form/>",{class:"cart-product-other__p"}),i=$("<input/>",{class:"cart-product-other__input product-quantity",type:"number","data-id":`${t.id_product}`,min:0,max:99,onkeydown:"return false",value:`${t.quantity}`}),c=$("<div/>",{class:"cart-product-other__p"}),o=$("<a/>",{href:`#del_${t.id_product}`,"data-id":`${t.id_product}`,class:"cart-product-other__del"});e.append($(`<img src="${t.min_img}" class="cart-product-details__img" alt="shopping_cart_img">`)),s.append($(`<a href="single-page.html" \n                          class="cart-product-details__link">\n                          <h3 class="cart-product-details__h">${t.product_name}</h3>\n                        </a>`)),s.append($('<p class="cart-product-details__p">Color:\n                        <span class="cart-product-details__span"> Red</span></p>')),s.append($('<p class="cart-product-details__p">Size:\n                        <span class="cart-product-details__span"> Xll</span></p>')),i.on("input",t=>{let a=+$(t.target).data("id"),e=this.cartItems.find(t=>t.id_product===a);t.target.value>e.quantity&&this.addProduct(t.target),t.target.value<e.quantity&&this._remove(t.target)}),r.append(i),o.on("click",t=>this._remove(t.target.parentNode)),o.append($('<i class="fas fa-times-circle"></i>')),c.append(o),a.append(e),a.append(s),a.append($(`<p class="cart-product-other__p product-price">$${t.price}</p>`)),a.append(r),a.append($('<p class="cart-product-other__p">FREE</p>')),a.append($(`<p class="cart-product-other__p product-sum">$${t.quantity*t.price}</p>`)),a.append(c),a.appendTo($(this.container))}_updateCart(t){let a=$(`div[data-id="${t.id_product}"]`);a.find(".product-price").text(`$${t.price}`),this.isBigCart&&a.find(".product-sum").text(`$${t.price*t.quantity}`),this.isBigCart?a.find(".product-quantity").val(t.quantity):a.find(".product-quantity").text(t.quantity)}addProduct(t){let a=+$(t).data("id"),e=this.cartItems.find(t=>t.id_product===a);if(e)e.quantity++,this.countGoods++,this.amount+=e.price,this._updateCart(e);else{let e={id_product:a,price:+$(t).data("price"),product_name:$(t).data("title"),min_img:$(t).data("img"),quantity:1};0===this.countGoods&&($(".emptyCart").remove(),$(".cart-buttons-box").show(),$(".cart-price").show()),this.cartItems.push(e),this.countGoods++,this.amount+=e.price,this.isBigCart?this._renderBigItem(e):this._renderItem(e)}localStorage.setItem("mycart",JSON.stringify(this.cartItems)),localStorage.setItem("countGoods",this.countGoods),localStorage.setItem("amount",this.amount),this._renderSum()}_remove(t){let a=$(t).data("id"),e=this.cartItems.find(t=>t.id_product===a);if(e)if(e.quantity--,this.countGoods--,this.amount-=e.price,0===e.quantity){t.parentNode.parentNode.remove();let e=this.cartItems.findIndex(t=>t.id_product===a);this.cartItems.splice(e,1)}else this._updateCart(e);else console.log("error");localStorage.setItem("mycart",JSON.stringify(this.cartItems)),localStorage.setItem("countGoods",this.countGoods),localStorage.setItem("amount",this.amount),this._renderSum()}_removeAll(){$(this.container).html(""),this.countGoods=0,this.amount=0,this.cartItems=[],localStorage.removeItem("mycart"),localStorage.removeItem("countGoods"),localStorage.removeItem("amount"),this._renderSum()}}
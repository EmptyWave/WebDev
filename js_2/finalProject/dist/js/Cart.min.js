class Cart{constructor(t,a="#cart"){this.source=t,this.container=a,this.countGoods=0,this.amount=0,this.cartItems=[],this._init(this.source)}_render(){let t=$("<div/>",{class:"cart-items-wrap"}),a=$("<div/>",{class:"cart-price"}),e=$("<div/>",{class:"cart-buttons-box"});$(this.container).text("Корзина"),t.appendTo($(this.container)),a.append($("<p>TOTAL</p>")),a.append($('<p class="sum-price"></p>')),a.appendTo($(this.container)),e.append($('<a class="button-site checkout-button" href="checkout.html">Checkout</a>')),e.append($('<a class="drop-cart-button" href="shopping-cart.html">Go to cart</a>')),e.appendTo($(this.container))}_init(t){if(this._render(),localStorage.getItem("mycart")){this.cartItems=JSON.parse(localStorage.getItem("mycart"));for(let t of this.cartItems)this._renderItem(t);this.countGoods=JSON.parse(localStorage.getItem("countGoods")),this.amount=JSON.parse(localStorage.getItem("amount")),this._renderSum()}else fetch(t).then(t=>t.json()).then(t=>{for(let a of t.contents)this.cartItems.push(a),this._renderItem(a);this.countGoods=t.countGoods,this.amount=t.amount,localStorage.setItem("mycart",JSON.stringify(this.cartItems)),localStorage.setItem("countGoods",this.countGoods),localStorage.setItem("amount",this.amount),this._renderSum()})}_renderSum(){$(".sum-price").text(`$${this.amount}`),0===this.countGoods&&$(this.container).hide()}_renderItem(t){let a=$("<div/>",{class:"cart-item-box"}),e=$("<div/>",{class:"cart-item-container"}),s=$("<a/>",{class:"single-page-link",href:"single-page.html"}),i=$("<div/>",{class:"cart-product-info","data-product":t.id_product}),o=$("<a/>",{class:"single-page-link",href:"single-page.html"}),r=$("<a>",{class:"cart-del-item",href:`#del_${t.id_product}`,"data-product":t.id_product});s.append($(`<img class="cart-img" src="${t.min_img}" alt="product1">`)),s.appendTo(e),o.append($(`<h3>${t.product_name}</h3>`)),o.appendTo(i),i.append($('<i class="fas fa-star item-stars"></i>')),i.append($('<i class="fas fa-star item-stars"></i>')),i.append($('<i class="fas fa-star item-stars"></i>')),i.append($('<i class="fas fa-star item-stars"></i>')),i.append($('<i class="fas fa-star-half-alt item-stars"></i>')),i.append($(`<p> <span class="product-quantity">${t.quantity}</span> x \n                            <span class="product-price">$${t.price}</span></p>`)),i.appendTo(e),r.on("click",t=>this._remove(t.target.parentNode)),r.append($('<i class="fas fa-times-circle"></i>')),r.appendTo(e),e.appendTo(a),a.appendTo($(".cart-items-wrap"))}_updateCart(t){let a=$(`div[data-product="${t.id_product}"]`);a.find(".product-quantity").text(t.quantity),a.find(".product-price").text(`$${t.price}`)}addProduct(t){let a=+$(t).data("id"),e=this.cartItems.find(t=>t.id_product===a);if(e)e.quantity++,this.countGoods++,this.amount+=e.price,this._updateCart(e);else{let e={id_product:a,price:+$(t).data("price"),product_name:$(t).data("title"),min_img:$(t).data("img"),quantity:1};this.cartItems.push(e),this.countGoods++,this.amount+=e.price,this._renderItem(e),$(this.container).show()}localStorage.setItem("mycart",JSON.stringify(this.cartItems)),localStorage.setItem("countGoods",this.countGoods),localStorage.setItem("amount",this.amount),this._renderSum()}_remove(t){let a=$(t).data("product"),e=this.cartItems.find(t=>t.id_product===a);if(e){if(e.quantity--,this.countGoods--,this.amount-=e.price,0===e.quantity){t.parentNode.parentNode.remove();let e=this.cartItems.findIndex(t=>t.id_product===a);this.cartItems.splice(e,1)}0===this.countGoods?$(this.container).hide():this._updateCart(e)}else console.log("error");localStorage.setItem("mycart",JSON.stringify(this.cartItems)),localStorage.setItem("countGoods",this.countGoods),localStorage.setItem("amount",this.amount),this._renderSum()}}